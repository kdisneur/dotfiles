#! /usr/bin/env bash

chmod 600 ~/.ssh/id_*
chmod 600 ~/.gnupg/*
chmod 755 ~/.git_template/hooks/*

[[ "${SHELL}" != "/bin/zsh" ]] &&  chsh -s /bin/zsh
[[ -e ~/.bin ]] && chmod u+x ~/.bin/*
[[ -e ~/.bin.local ]] && chmod u+x ~/.bin.local/*

if [[ ! -e ~/.asdf ]]; then
  git clone https://github.com/asdf-vm/asdf.git ~/.asdf
  pushd ~/.asdf
  git checkout "$(git describe --abbrev=0 --tags)"
  popd
fi

if [[ -e ~/.tool-versions ]]; then
  cut -f 1 -d ' ' ~/.tool-versions | xargs -L1 asdf plugin-add
  asdf install
fi

[[ ! -e ~/.zsh/completion/_docker ]] && curl -fLo ~/.zsh/completion/_docker --create-dirs https://raw.githubusercontent.com/docker/cli/master/contrib/completion/zsh/_docker
[[ ! -e ~/.zsh/completion/_docker-compose ]] && curl -fLo ~/.zsh/completion/_docker-compose --create-dirs https://raw.githubusercontent.com/docker/compose/master/contrib/completion/zsh/_docker-compose

[[ ! -e /usr/local/bin/brew ]] && /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
brew bundle check --file=$(dirname $0)/../Brewfile > /dev/null || brew bundle --file=$(dirname $0)/../Brewfile

[[ ! -e ~/.config/zsh-syntax-highlighting ]] && git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ~/.config/zsh-syntax-highlighting

[[ ! -e ~/.vim/autoload/plug.vim ]] && curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
vim +PlugInstall +qa -

if [[ ! -d ~/Workspace/JakeBecker/elixir-ls ]]; then
  mkdir -p ~/Workspace/JakeBecker/;
  pushd ~/Workspace/JakeBecker/;
  git clone git@github.com:JakeBecker/elixir-ls.git;
  pushd elixir-ls
  mix local.hex --force;
  mix local.rebar --force;
  mix deps.get && mix compile;
  mix elixir_ls.release -o rel;
  popd;
  popd;
fi
